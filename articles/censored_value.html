<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fonctions pour traiter les valeurs censurées dans les bases de données de contaminants • toxbox</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fonctions pour traiter les valeurs censurées dans les bases de données de contaminants">
<meta property="og:description" content="toxbox">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">toxbox</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/censored_value.html">Fonctions pour traiter les valeurs censurées dans les bases de données de contaminants</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ECCC-lavoie-ecotox/toxbox/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fonctions pour traiter les valeurs censurées
dans les bases de données de contaminants</h1>
                        <h4 data-toc-skip class="author">Rose
Lacombe</h4>
            
            <h4 data-toc-skip class="date">2024-01-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ECCC-lavoie-ecotox/toxbox/blob/HEAD/vignettes/articles/censored_value.Rmd" class="external-link"><code>vignettes/articles/censored_value.Rmd</code></a></small>
      <div class="hidden name"><code>censored_value.Rmd</code></div>

    </div>

    
    
<p>Dans ce document, on retrouve les fonctions que nous avons créé pour
imputer des valeurs avec des données censurées de contaminants
d’ECCC.</p>
<p>Les packages nécessaires sont:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">NADA</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/SwampThingPaul/NADA2" class="external-link">NADA2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="limputation-de-valeurs-censurées">L’imputation de valeurs censurées<a class="anchor" aria-label="anchor" href="#limputation-de-valeurs-censur%C3%A9es"></a>
</h3>
<p>La première fonction, censor() accepte des jeux de données qui
contiennent des valeurs censurées (càd des données sous la limite de
détection/quantification) formatées comme-ci: “&lt;0.001”. Les premières
colonnes dans le jeu de données doivent être celles que nous ne voulons
pas “dé-censurer”, donc des colonnes non-numériques (ex. FID, Location,
Sex) et les colonnes numériques que nous ne souhaitons pas dé-censurer
(ex. Year, isotopes stables, mesures morphométriques).</p>
<p>La fonction analysera chaque colonne individuellement à partir de la
colonne de départ préalablement spécifiée. Par la suite, une nouvelle
colonne, nommée avec le nom du composé et le suffixe “cen” sera ensuite
créée et contiendra un indicateur binaire TRUE ou FALSE. Si une
observation du composé contient un “&lt;”, c’est-à-dire que c’est une
valeur censurée, l’observation dans la nouvelle colonne (l’indicateur de
censure) sera “TRUE”. Si l’observation n’est pas censurée, l’indicateur
sera “FALSE”. Ceci nous permettra d’utiliser des packages R développés
pour des valeurs censurées. Enfin, la fonction censor() retirera les
symboles “&lt;” du jeu de données et numérisera toutes les colonnes
contenant des données de contaminants. À ce stade, le jeu de données
contiendra des vraies concentrations de contaminants (“FALSE” dans la
colonne indicatrice du composé) et des limites de détection (“TRUE” dans
les colonnes indicatrices).</p>
<p>Pour utiliser la fonction, il suffit de faire rouler les lignes
suivantes:</p>
<pre><code><span><span class="fu">censor</span><span class="op">(</span><span class="va">data</span>, <span class="va">t</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#For example </span></span>
<span><span class="va">OCcen</span> <span class="op">&lt;-</span> <span class="fu">censor</span><span class="op">(</span><span class="va">OC</span>, <span class="fl">8</span><span class="op">)</span></span></code></pre>
<p>t dénote le numéro de la colonne à laquelle nous voulons commencer le
processus de “dé-censuration”.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">censor</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="co">#create a vector of col names for future naming ease</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">t</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co">#t = number of the col we start at </span></span>
<span>    <span class="co">#(skip the sample info, start at first compound)</span></span>
<span>    </span>
<span>    <span class="co">#if "&lt;" is found, put TRUE in the new col because it is a non-detect, </span></span>
<span>    <span class="co">#if not, put FALSE (= uncensored value)</span></span>
<span>    <span class="va">data</span><span class="op">$</span><span class="va">new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span> <span class="st">"&lt;"</span>, <span class="va">data</span><span class="op">[</span>, <span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="co">#paste the compound name to the col head followed by "cen"</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="st">'new'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">cols</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="st">"cen"</span><span class="op">)</span> </span>
<span>    <span class="co">#if "&lt;" is found, remove it for easy numeric conversion</span></span>
<span>    <span class="va">data</span><span class="op">[</span>, <span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span>, <span class="st">"&lt;"</span>, <span class="st">""</span><span class="op">)</span> </span>
<span>    <span class="co">#convert to numeric</span></span>
<span>    <span class="va">data</span><span class="op">[</span>, <span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Une fois le jeu de donné “dé-censuré”, les valeurs pour les
observations qui étaient sous la limite de détection peuvent être
imputées.</p>
<p>L’input doit contenir ces colonnes: “FID”, “Year”, “d15N”,
“d13C”<em>, et “Lipid”. Si une ou plusieurs de ces colonnes ne sont pas
présentes dans le jeu de données, il vous faut simplement ajouter une
colonne vide avec le nom approprié. </em>Note:* En plus des colonnes
mentionnées précédemment nous pouvons inclure d’autres facteurs
(colonnes) pour lesquels les valeurs de doivent pas être dé-censurées.
Pour ce fait, simplement ajouter le nom du facteur dans les lignes de
code ci-dessous où #COVARIATES est inscrit.</p>
<p>*Dans le cas de données historiques, nous devons corriger le d13C
pour l’effet Suess. On peut changer le nom dans la fonction en
remplaçant le d13C (d13c -&gt; d13CS).</p>
<p><em>Note:</em> La fonction ci-dessous inclut Year et Location -
c’est-à-dire que les observations seront regroupées par Année et par
Site pour permettre ensuite l’imputation des valeurs censurées.
Toutefois, si seulement un de ces facteurs est nécessaire, il suffit de
retirer le second du script (#dénoté par 3 étoiles à la fin de la ligne
de script).</p>
<p>Tout d’abord, la fonction séparera les valeurs qui ne doivent pas
être imputées (ex. d15N, d13CS, Lipid, etc.). Ces colonnes seront
rajoutées à l’output final. Ensuite, le jeu de données sera groupé puis
séparé par Année et par Site. La première loop sélectionne et isole
chaque combinaison Année-Site individuellement pour que faciliter
l’imputation des valeurs le plus simplement possible. La deuxième loop*
(qui se trouve à l’intérieur de la première) sélectionne les composés un
par un et isole la colonne contenant les données (réelles et censurées),
ainsi que la colonne avec l’indicateur de censure correspondant.
<em>Important:</em> deux lignes de code très importantes empêche de
briser la loop: 1. si toutes les valeurs pour un composé dans l’Année et
le Site isolé sont “NA”, la fonction passera directement au prochain
composé. 2. si trop de valeurs sont des limites de détection (“TRUE”
dans la colonne indicatrice), les valeurs ne peuvent pas être imputées
car pas assez de vraies données présentes et par conséquent la fonction
passera directement au prochain composé.</p>
<p>*La deuxième loop utilise l’argument h, qui dénote le numéro de la
colonne du premier composé (contaminant). Par exemple, h = 4 si Site et
Année sont inclus, mais h = 3 si seulement un de ses deux facteurs est
inclus, puisque le jeu de données entrant dans la deuxième loop sera
formaté comme tel : “FID”, “Year”, “Location”, “Composé 1”, etc.</p>
<p>La fonction cenros() du package NADA sera utiliser pour calculer des
moyennes en tenant compte des valeurs censurées, et permet d’interpoler
des valeurs fictives afin d’obtenir ces moyennes. Cette fonction se base
sur la méthode statistique “régression d’ordre statistique” (ROS)
permettant d’assigner des valeurs interpolées aux valeurs censurées
présentes dans le jeu de données. Le processus est répété pour chaque
composé à l’intérieur d’une Année et d’un Site, et également pour chaque
combinaison de groupes Année-Site. Les résultats seront ajoutés à un
dataframe vide (Format : long). Lorsque les deux loops complétées, le
dataframe sera transposé en format wide.</p>
<p><strong>Pour l’instant j’ai retiré cette opération pour que des NAs
restent</strong>: puis on remplace les NA restants (ceux qui ont été
sauté à cause de trop de non-detects) avec une valeur égale à la moitié
de la limite de détection, provenant d’un fichier LOD qui est inclut
dans le input de la fonction. Le fichier LOD doit contenir une ligne par
échantillon, avec la limite de détection pour chaque composé à chaque
année. #</p>
<p>La fonction impute() est utilisée comme-ci:</p>
<pre><code><span><span class="fu">impute</span><span class="op">(</span><span class="va">data</span>, <span class="va">h</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#For example</span></span>
<span><span class="va">OCint</span> <span class="op">&lt;-</span> <span class="fu">impute</span><span class="op">(</span><span class="va">OCcen</span>, <span class="fl">9</span><span class="op">)</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">impute</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">h</span><span class="op">)</span> <span class="op">{</span> <span class="co">#h is column the second loop starts at. D</span></span>
<span>  <span class="co">#etermined by what you are including</span></span>
<span>  <span class="co">#In only year and FID, h = 3, if Year and location, h = 4</span></span>
<span>  <span class="va">SI</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">data</span>, select<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">FID</span>, <span class="va">Year</span>, <span class="va">Location</span>, <span class="va">d15N</span>, <span class="va">d13C</span>, <span class="va">d34S</span>, <span class="va">Lipid</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="co">#*COVARIATES*</span></span>
<span>  <span class="co">#to merge with our interpolated data set later</span></span>
<span>  <span class="va">dat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">data</span>, select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">d15N</span>, <span class="va">d13C</span>, <span class="va">d34S</span>, <span class="va">Lipid</span><span class="op">)</span><span class="op">)</span> <span class="co">#*COVARIATES* </span></span>
<span>  <span class="co">#only keep year, location, FID, and compound values and censor indicators</span></span>
<span>  <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">colony</span> <span class="op">&lt;-</span> <span class="va">dat2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Location</span>, <span class="va">Year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html" class="external-link">group_split</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>FID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      Location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      Year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      Compound <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      Concentration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co">#make empty dataframe - long </span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">colony</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co">#start with the group in list </span></span>
<span>    <span class="co">#i=1 #troubleshooting</span></span>
<span>    </span>
<span>    <span class="va">loc</span> <span class="op">&lt;-</span> <span class="va">colony</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="co">#isolate group year for coding simplicity</span></span>
<span>    <span class="va">k</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">loc</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">loc</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">loc</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> </span>
<span>    <span class="co">#calculates the halfway mark of the df, </span></span>
<span>    <span class="co">#i.e. where the compounds stop and censure indicators start</span></span>
<span>    </span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">f</span> <span class="kw">in</span> <span class="va">h</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span> <span class="co">#start at first compound: 3rd col</span></span>
<span>      <span class="co">#f=4 #troubleshooting</span></span>
<span>      </span>
<span>      <span class="co">#isolate so we only have compound values and indicators</span></span>
<span>      <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="va">cols</span><span class="op">[</span><span class="va">f</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">loc</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co">#find censor indicator </span></span>
<span>      <span class="va">comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">loc</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">x</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="co">#isolate the compound and cen</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">comp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FID"</span>, <span class="st">"Compound"</span>, <span class="st">"Cen"</span><span class="op">)</span></span>
<span>      <span class="va">comp2</span> <span class="op">&lt;-</span> <span class="va">comp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">comp</span><span class="op">$</span><span class="va">Compound</span>, decreasing <span class="op">=</span> <span class="cn">FALSE</span>, na.last <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,<span class="op">]</span></span>
<span>      </span>
<span>      <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">loc</span><span class="op">)</span> <span class="co">#how many obs do we have in this group</span></span>
<span>      <span class="va">e</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">-</span><span class="fl">1</span></span>
<span>      </span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">d</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">loc</span><span class="op">$</span><span class="va">FID</span><span class="op">)</span><span class="op">}</span> <span class="co">#Tells us which are singular in their group </span></span>
<span>      <span class="co">#(ex. single sample in that year/location)</span></span>
<span>      </span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">comp</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="kw">next</span> <span class="co">#If all vals are ND, skip </span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="va">comp2</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">e</span><span class="op">)</span> <span class="kw">next</span> <span class="co">#If all vals are ND, skip </span></span>
<span>      </span>
<span>      <span class="co">#convert to ROS object</span></span>
<span>      <span class="va">compros</span> <span class="op">&lt;-</span> <span class="fu">cenros</span><span class="op">(</span><span class="va">comp2</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">comp2</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="co">#We want to keep each ind value so we can pool them properly later</span></span>
<span>      </span>
<span>      <span class="va">add</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>FID <span class="op">=</span> <span class="va">comp2</span><span class="op">$</span><span class="va">FID</span>, <span class="co">#add IDs</span></span>
<span>                        Location <span class="op">=</span> <span class="va">loc</span><span class="op">$</span><span class="va">Location</span>, <span class="co">#add all the years </span></span>
<span>                        Year <span class="op">=</span> <span class="va">loc</span><span class="op">$</span><span class="va">Year</span>,</span>
<span>                        Compound <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">cols</span><span class="op">[</span><span class="va">f</span><span class="op">]</span>, times <span class="op">=</span> <span class="va">d</span><span class="op">)</span>, <span class="co">#Compound name</span></span>
<span>                        Concentration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dput.html" class="external-link">dput</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">compros</span><span class="op">$</span><span class="va">modeled</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">stats</span>, <span class="va">add</span><span class="op">)</span> <span class="co">#append new rows</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">interp</span> <span class="op">&lt;-</span> <span class="va">stats</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Location</span>, <span class="va">Year</span>, <span class="va">Compound</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">pivot_wider</span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">FID</span>, <span class="va">Location</span>, <span class="va">Year</span><span class="op">)</span>, </span>
<span>                names_from <span class="op">=</span> <span class="va">Compound</span>, values_from <span class="op">=</span> <span class="va">Concentration</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co">#Here we are filling the remaining NAs (caused by non-detects) </span></span>
<span>  <span class="co">#with LOD/2 values so we don't have empty data</span></span>
<span>  <span class="co">#patched &lt;- rows_patch(interp, LOD, by = "FID")</span></span>
<span>  </span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">SI</span>, <span class="va">interp</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FID"</span>, <span class="st">"Location"</span>, <span class="st">"Year"</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="co">#patched instead of interp if patching</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Dans la fonction impute(), une commande indique si un échantillon est
seul dans son groupe Année-Site (impute l’exclu par défaut). Nous ne
pouvons pas utiliser les méthode de non-detects (ROS) sur un seul
échantillon et la fonction impute() exclu l’échantillon seul par défaut.
Cette ligne de code demande à R d’imprimer le FID de l’échantillon si
tel est le cas. Il est donc <em>important</em> de vérifier le output de
impute() dans la console si des FID ont été imprimés. En les isolants
(voir exemple plus bas), nous pouvons passer les échantillons “seuls”
dans la fonction singles(). Singles() est adaptée de la fonction
impute() afin de rapporter les valeurs non-censurées, et de remplacer
les limites de détection par NA. Singles() prend le même argument h que
impute().</p>
<pre><code><span><span class="fu">singles</span><span class="op">(</span><span class="va">data</span>, <span class="va">h</span><span class="op">)</span></span>
<span><span class="co">#for example</span></span>
<span><span class="va">ocextra</span> <span class="op">&lt;-</span> <span class="fu">singles</span><span class="op">(</span><span class="va">OCcen</span>, <span class="fl">9</span><span class="op">)</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">singles</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">h</span><span class="op">)</span> <span class="op">{</span> <span class="co">#h is column the second loop starts at. </span></span>
<span>  <span class="co">#In only year and FID, h = 3, if Year and location, h = 4</span></span>
<span>  <span class="va">SI</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">data</span>, select<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">FID</span>, <span class="va">Year</span>, <span class="va">Location</span>, <span class="va">d15N</span>, <span class="va">d13C</span>, <span class="va">d34S</span>, <span class="va">Lipid</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="co">#*COVARIATES* above </span></span>
<span>  <span class="co">#to merge with our interpolated data set later</span></span>
<span>  <span class="va">dat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">data</span>, select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">d15N</span>, <span class="va">d13C</span>, <span class="va">d34S</span>, <span class="va">Lipid</span><span class="op">)</span><span class="op">)</span> <span class="co">#*COVARIATES* </span></span>
<span>  <span class="co">#only keep year, location, FID, and compound values and censor indicators</span></span>
<span>  <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">colony</span> <span class="op">&lt;-</span> <span class="va">dat2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Location</span>, <span class="va">Year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html" class="external-link">group_split</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>FID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      Location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      Year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      Compound <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      Concentration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co">#make empty dataframe </span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">colony</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co">#start with the first group in list </span></span>
<span>    <span class="co">#i=2 #troubleshooting</span></span>
<span>    </span>
<span>    <span class="va">loc</span> <span class="op">&lt;-</span> <span class="va">colony</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="co">#isolate group location for coding simplicity</span></span>
<span>    <span class="va">k</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">loc</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">loc</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">loc</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">f</span> <span class="kw">in</span> <span class="va">h</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span> <span class="co">#start at first compound: 3rd col</span></span>
<span>      <span class="co">#f=4 #troubleshooting</span></span>
<span>      </span>
<span>      <span class="co">#isolate so we only have compound values and indicators</span></span>
<span>      <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="va">cols</span><span class="op">[</span><span class="va">f</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">loc</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co">#find censor indicator </span></span>
<span>      <span class="va">comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">loc</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">x</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="co">#isolate the compound and censor ind</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">comp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FID"</span>, <span class="st">"Compound"</span>, <span class="st">"Cen"</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="co">#for singles we only keep values if their censure indicator is FALSE</span></span>
<span>      </span>
<span>      <span class="va">add</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>FID <span class="op">=</span> <span class="va">comp</span><span class="op">$</span><span class="va">FID</span>, <span class="co">#add IDs</span></span>
<span>                        Location <span class="op">=</span> <span class="va">loc</span><span class="op">$</span><span class="va">Location</span>, <span class="co">#add all the years </span></span>
<span>                        Year <span class="op">=</span> <span class="va">loc</span><span class="op">$</span><span class="va">Year</span>,</span>
<span>                        Compound <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="va">f</span><span class="op">]</span>, <span class="co">#paste in the Compound name </span></span>
<span>                        Concentration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">comp</span><span class="op">$</span><span class="va">Cen</span> <span class="op">==</span> <span class="st">"FALSE"</span>, </span>
<span>                                               <span class="va">comp</span><span class="op">$</span><span class="va">Compound</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> </span>
<span>      <span class="co">#If value is uncensored (FALSE), put the compound data, if censured put NA</span></span>
<span>      </span>
<span>      <span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">stats</span>, <span class="va">add</span><span class="op">)</span> <span class="co">#append new rows</span></span>
<span>      </span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">interp</span> <span class="op">&lt;-</span> <span class="va">stats</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Location</span>, <span class="va">Compound</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">pivot_wider</span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">FID</span>, <span class="va">Year</span>, <span class="va">Location</span><span class="op">)</span>, </span>
<span>                names_from <span class="op">=</span> <span class="va">Compound</span>, values_from <span class="op">=</span> <span class="va">Concentration</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co">#Here we are filling the remaining NAs (caused by non-detects) </span></span>
<span>  <span class="co">#with LOD/2 values so we don't have empty data</span></span>
<span>  <span class="co">#patched &lt;- rows_patch(interp, LOD, by = "FID")</span></span>
<span>  </span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">SI</span>, <span class="va">interp</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FID"</span>, <span class="st">"Location"</span>, <span class="st">"Year"</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="co">#patched instead of interp if patching</span></span>
<span>  </span>
<span><span class="op">}</span> <span class="co">#Essentially impute() for locations with single observations </span></span>
<span><span class="co">#(i.e. imputing NDs is impossible so we exculde censured data and keep real values)</span></span></code></pre></div>
<p>L’exemple suivant montre comment identifier des échantillons seuls et
les rajouter dans le output de impute():</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>pcbex <span class="ot">&lt;-</span> PCBcen[PCBcen<span class="sc">$</span>FID <span class="sc">==</span> <span class="st">"W222559-01"</span><span class="sc">|</span> PCBcen<span class="sc">$</span>FID <span class="sc">==</span> <span class="st">"W221979-02"</span>, ] </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#find x or y that were printed by impute</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>pcbex1 <span class="ot">&lt;-</span> <span class="fu">singles</span>(pcbex, <span class="dv">4</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>Append to impute output</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>PCBint <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(PCBint, pcbex1) <span class="co">#Bind the two dataframes </span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#but keep columns even if there aren't in both dfs</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>PCBint <span class="ot">&lt;-</span> PCBint[,<span class="fu">colSums</span>(<span class="fu">is.na</span>(PCBint)) <span class="sc">&lt;</span> <span class="fu">nrow</span>(PCBint)] </span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#remove columns composed only of NAs</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="les-sommes-des-valeurs-censurées">Les sommes des valeurs censurées<a class="anchor" aria-label="anchor" href="#les-sommes-des-valeurs-censur%C3%A9es"></a>
</h3>
<p>Pour calculer les sommes de différentes familles de composés, la
méthode Kaplan Meier (KM) est utilisée pour calculer des moyennes en
tenant compte de plusieurs valeurs censurées différentes. La moyenne est
la somme divisée par le nombre d’observations :</p>
<pre><code>moyenne = somme des observations / nombre d'observations</code></pre>
<p>ainsi la somme peut être facilement déduite en ce basant sur
l’équation de la moyenne:</p>
<pre><code>Somme = moyenne * nombre d'observations</code></pre>
<p>Par conséquent, la moyenne estimée à l’aide de la méthode KM
multipliée par le nombre d’observations (dans ce cas le nombre de
composé) permet d’obtenir la somme estimée.</p>
<p>Malheureusement, il est difficile de construire une fonction pour
calculer les sommes puisque les familles diffèrent par groupe de
contaminants (OC, PCB, BFR). Ainsi, la loop développées ci-dessous devra
être modifiée pour chaque groupe séparemment (et ce même dans chaque
script dépendant des données).</p>
<p>Il est important de noter que les sommes décrites dans les loops
ci-bas ne sont que des exemples des sommes que nous pouvons calculer.
Les loops peuvent être modifier pour satisfaire vos besoins en ajoutat
ou en retirant des sommes ou des composés.</p>
<p>Pour les OC:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OCsums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>FID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   Sum14OC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   SumDDT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   SumCHL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   SumHCH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">OCcen</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co">#cycles through the individual samples</span></span>
<span>  <span class="co">#i=48 #troubleshooting</span></span>
<span>  </span>
<span>  <span class="va">ind</span> <span class="op">&lt;-</span> <span class="va">OCcen</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  <span class="va">indconc</span> <span class="op">&lt;-</span> <span class="va">ind</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">19</span>, </span>
<span>                  names_to <span class="op">=</span> <span class="st">"Compound"</span>, values_to <span class="op">=</span> <span class="st">"Concentration"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FID"</span>, <span class="st">"Year"</span>,<span class="st">"Compound"</span>, <span class="st">"Concentration"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">indcen</span> <span class="op">&lt;-</span> <span class="va">ind</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">20</span><span class="op">:</span><span class="fl">33</span>, </span>
<span>                            names_to <span class="op">=</span> <span class="st">"Compound"</span>, values_to <span class="op">=</span> <span class="st">"Cen"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FID"</span>, <span class="st">"Year"</span>,<span class="st">"Compound"</span>, <span class="st">"Cen"</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="va">indcen</span><span class="op">$</span><span class="va">Compound</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">indcen</span><span class="op">$</span><span class="va">Compound</span>, <span class="st">"cen"</span>, <span class="st">""</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">indlong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">indconc</span>, <span class="va">indcen</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FID"</span>, <span class="st">"Year"</span>, <span class="st">"Compound"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">indlong</span><span class="op">$</span><span class="va">FID</span><span class="op">)</span> <span class="co">#see where errors are occuring</span></span>
<span>  </span>
<span>  <span class="co">#First all 14 OCs</span></span>
<span>  <span class="va">U</span> <span class="op">&lt;-</span> <span class="va">indlong</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">V</span> <span class="op">&lt;-</span> <span class="va">indlong</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  <span class="va">indfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="fu">censtats</span><span class="op">(</span><span class="va">U</span>, <span class="va">V</span><span class="op">)</span><span class="op">)</span> <span class="co">#need to be vectors</span></span>
<span>  </span>
<span>  <span class="va">num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">indlong</span><span class="op">)</span></span>
<span>  <span class="va">sum14</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">indfit</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">num</span></span>
<span>  </span>
<span>  <span class="co">#Now DDT compounds</span></span>
<span>  <span class="va">ddt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="va">Compound</span> <span class="op">==</span> <span class="st">"ppDDD"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"ppDDE"</span> <span class="op">|</span> </span>
<span>                  <span class="va">Compound</span> <span class="op">==</span> <span class="st">"ppDDT"</span><span class="op">)</span> <span class="co">#If we are missing one of these from OCint, </span></span>
<span>  <span class="co">#it is a good indicator we'll be missing it here so remove it from the list, and </span></span>
<span>  <span class="co">#reduce the number in the if statement by the number of compounds removed</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="va">ddt</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">indlong</span><span class="op">$</span><span class="va">FID</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="va">ddt</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span> <span class="kw">next</span> <span class="co">#If all vals are ND, skip to next</span></span>
<span>  <span class="va">ddtc</span> <span class="op">&lt;-</span> <span class="va">ddt</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">ddtcen</span> <span class="op">&lt;-</span> <span class="va">ddt</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  <span class="va">ddtfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">ddt</span>, <span class="fu">censtats</span><span class="op">(</span><span class="va">ddtc</span>, <span class="va">ddtcen</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="va">DDT</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">ddtfit</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span> <span class="fl">3</span>  <span class="co">#multiply estimated mean by # compounds</span></span>
<span>  </span>
<span>  <span class="co">#SumCHL</span></span>
<span>  <span class="va">chl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="va">Compound</span> <span class="op">==</span> <span class="st">"OxyChlordane"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"cChlordane"</span> </span>
<span>                <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"tChlordane"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"cNonachlor"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="va">chl</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">indlong</span><span class="op">$</span><span class="va">FID</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="va">chl</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">4</span><span class="op">)</span> <span class="kw">next</span> <span class="co">#If all vals are ND, skip to next</span></span>
<span>  </span>
<span>  <span class="va">chlc</span> <span class="op">&lt;-</span> <span class="va">chl</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">chlcen</span> <span class="op">&lt;-</span> <span class="va">chl</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  <span class="va">chlfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">chl</span>, <span class="fu">censtats</span><span class="op">(</span><span class="va">chlc</span>, <span class="va">chlcen</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">CHL</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">chlfit</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span> <span class="fl">4</span>  <span class="co">#multiply estimated mean by # compounds</span></span>
<span>  </span>
<span>  <span class="co">#SumHCH</span></span>
<span>  <span class="va">hch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="va">Compound</span> <span class="op">==</span> <span class="st">"aHCH"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"bHCH"</span> <span class="op">|</span> </span>
<span>                  <span class="va">Compound</span> <span class="op">==</span> <span class="st">"gHCH"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="va">hch</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span> <span class="kw">next</span> <span class="co">#If all vals are ND, skip </span></span>
<span>  </span>
<span>  <span class="va">hchc</span> <span class="op">&lt;-</span> <span class="va">hch</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">hchcen</span> <span class="op">&lt;-</span> <span class="va">hch</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  <span class="va">hchfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">hch</span>, <span class="fu">censtats</span><span class="op">(</span><span class="va">hchc</span>, <span class="va">hchcen</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">HCH</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">hchfit</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span> <span class="fl">3</span> <span class="co">#multiply estimated mean by # compounds</span></span>
<span>  </span>
<span>  <span class="va">add</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>FID <span class="op">=</span> <span class="va">ind</span><span class="op">$</span><span class="va">FID</span>,</span>
<span>                    Sum14OC <span class="op">=</span> <span class="va">sum14</span>,</span>
<span>                    SumDDT <span class="op">=</span> <span class="va">DDT</span>,</span>
<span>                    SumCHL <span class="op">=</span> <span class="va">CHL</span>,</span>
<span>                    SumHCH <span class="op">=</span> <span class="va">HCH</span><span class="op">)</span></span>
<span>  <span class="va">OCsums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">OCsums</span>, <span class="va">add</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Pour les PCB: (<strong>Important</strong>: Faire attention aux
espaces dans les noms des composés)</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PCBsums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>FID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      SumPCB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      SumTetra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      SumPenta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      SumHexa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      SumHepta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      SumOcta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      SumOrtho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      Sum6 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PCBcen</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co">#cycles through the individual samples</span></span>
<span>  <span class="co">#i= 24 #troubleshooting</span></span>
<span>  </span>
<span>  <span class="va">ind</span> <span class="op">&lt;-</span> <span class="va">PCBcen</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  <span class="va">indconc</span> <span class="op">&lt;-</span> <span class="va">ind</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">43</span>, </span>
<span>                        names_to <span class="op">=</span> <span class="st">"Compound"</span>, values_to <span class="op">=</span> <span class="st">"Concentration"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FID"</span>, <span class="st">"Year"</span>,<span class="st">"Compound"</span>, <span class="st">"Concentration"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">indcen</span> <span class="op">&lt;-</span> <span class="va">ind</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">44</span><span class="op">:</span><span class="fl">78</span>, </span>
<span>                            names_to <span class="op">=</span> <span class="st">"Compound"</span>, values_to <span class="op">=</span> <span class="st">"Cen"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FID"</span>, <span class="st">"Year"</span>,<span class="st">"Compound"</span>, <span class="st">"Cen"</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="va">indcen</span><span class="op">$</span><span class="va">Compound</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">indcen</span><span class="op">$</span><span class="va">Compound</span>, <span class="st">"cen"</span>, <span class="st">""</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">indlong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">indconc</span>, <span class="va">indcen</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FID"</span>, <span class="st">"Year"</span>, <span class="st">"Compound"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">indlong</span><span class="op">$</span><span class="va">FID</span><span class="op">)</span> <span class="co">#see where errors are occuring</span></span>
<span>  </span>
<span>  <span class="co">#First all PCBs</span></span>
<span>  <span class="va">U</span> <span class="op">&lt;-</span> <span class="va">indlong</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">V</span> <span class="op">&lt;-</span> <span class="va">indlong</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  <span class="va">indfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="fu">censtats</span><span class="op">(</span><span class="va">U</span>, <span class="va">V</span><span class="op">)</span><span class="op">)</span> <span class="co">#need to be vectors</span></span>
<span>  </span>
<span>  <span class="va">num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">indlong</span><span class="op">)</span></span>
<span>  <span class="va">sumPCB</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">indfit</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">num</span></span>
<span>  </span>
<span>  <span class="co">#Tetra</span></span>
<span>  <span class="va">tetra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB52"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB49"</span> <span class="op">|</span> </span>
<span>                    <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB44"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB70"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="va">tetra</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">indlong</span><span class="op">$</span><span class="va">FID</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="va">tetra</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">4</span><span class="op">)</span> <span class="kw">next</span> <span class="co">#If all vals are ND, skip </span></span>
<span>  <span class="va">tetrac</span> <span class="op">&lt;-</span> <span class="va">tetra</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">tetracen</span> <span class="op">&lt;-</span> <span class="va">tetra</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  <span class="va">tetrafit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">tetra</span>, <span class="fu">censtats</span><span class="op">(</span><span class="va">tetrac</span>, <span class="va">tetracen</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="va">TETRA</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">tetrafit</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tetra</span><span class="op">)</span> <span class="co">#multiply mean  by # compounds</span></span>
<span>  </span>
<span>  <span class="co">#Penta</span></span>
<span>  <span class="va">penta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB87"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB99"</span> <span class="op">|</span> </span>
<span>                    <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB101"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB105"</span> <span class="op">|</span> </span>
<span>                    <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB110"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB118"</span><span class="op">)</span></span>
<span>  <span class="va">pentac</span> <span class="op">&lt;-</span> <span class="va">penta</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">pentacen</span> <span class="op">&lt;-</span> <span class="va">penta</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  <span class="va">pentafit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">penta</span>, <span class="fu">censtats</span><span class="op">(</span><span class="va">pentac</span>, <span class="va">pentacen</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">PENTA</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">pentafit</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">penta</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co">#Hexa</span></span>
<span>  <span class="va">hexa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB128"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB138"</span> <span class="op">|</span> </span>
<span>                   <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB151"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB153"</span> <span class="op">|</span> </span>
<span>                   <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB158"</span><span class="op">)</span></span>
<span>  <span class="va">hexac</span> <span class="op">&lt;-</span> <span class="va">hexa</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">hexacen</span> <span class="op">&lt;-</span> <span class="va">hexa</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  <span class="va">hexafit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">hexa</span>, <span class="fu">censtats</span><span class="op">(</span><span class="va">hexac</span>, <span class="va">hexacen</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">HEXA</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">hexafit</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">hexa</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co">#Hepta</span></span>
<span>  <span class="va">hepta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB170"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB171"</span> <span class="op">|</span> </span>
<span>                    <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB180"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB183"</span> <span class="op">|</span> </span>
<span>                    <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB187"</span><span class="op">)</span></span>
<span>  <span class="va">heptac</span> <span class="op">&lt;-</span> <span class="va">hepta</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">heptacen</span> <span class="op">&lt;-</span> <span class="va">hepta</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  <span class="va">heptafit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">hepta</span>, <span class="fu">censtats</span><span class="op">(</span><span class="va">heptac</span>, <span class="va">heptacen</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">HEPTA</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">heptafit</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">hepta</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#Octa</span></span>
<span>  <span class="va">octa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB194"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB195"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="va">octa</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">indlong</span><span class="op">$</span><span class="va">FID</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="va">octa</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span> <span class="kw">next</span> <span class="co">#If all vals are ND, next</span></span>
<span>  <span class="va">octac</span> <span class="op">&lt;-</span> <span class="va">octa</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">octacen</span> <span class="op">&lt;-</span> <span class="va">octa</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  <span class="va">octafit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">octa</span>, <span class="fu">censtats</span><span class="op">(</span><span class="va">octac</span>, <span class="va">octacen</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">OCTA</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">octafit</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">octa</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#Ortho</span></span>
<span>  <span class="va">ortho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB70"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB105"</span> <span class="op">|</span> </span>
<span>                    <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB118"</span><span class="op">)</span></span>
<span>  <span class="va">orthoc</span> <span class="op">&lt;-</span> <span class="va">ortho</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">orthocen</span> <span class="op">&lt;-</span> <span class="va">ortho</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  <span class="va">orthofit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">ortho</span>, <span class="fu">censtats</span><span class="op">(</span><span class="va">orthoc</span>, <span class="va">orthocen</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ORTHO</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">orthofit</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ortho</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#Sum of 6</span></span>
<span>  <span class="va">six</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB31/28"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB101"</span> <span class="op">|</span> </span>
<span>                  <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB138"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB153"</span> <span class="op">|</span> </span>
<span>                  <span class="va">Compound</span> <span class="op">==</span> <span class="st">"PCB180"</span><span class="op">)</span></span>
<span>  <span class="va">sixc</span> <span class="op">&lt;-</span> <span class="va">six</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">sixcen</span> <span class="op">&lt;-</span> <span class="va">six</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  <span class="va">sixfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">six</span>, <span class="fu">censtats</span><span class="op">(</span><span class="va">sixc</span>, <span class="va">sixcen</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">SIX</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">sixfit</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">six</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">add</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>FID <span class="op">=</span> <span class="va">ind</span><span class="op">$</span><span class="va">FID</span>,</span>
<span>                    SumPCB <span class="op">=</span> <span class="va">sumPCB</span>,</span>
<span>                    SumTetra <span class="op">=</span> <span class="va">TETRA</span>,</span>
<span>                    SumPenta <span class="op">=</span> <span class="va">PENTA</span>,</span>
<span>                    SumHexa <span class="op">=</span> <span class="va">HEXA</span>,</span>
<span>                    SumHepta <span class="op">=</span> <span class="va">HEPTA</span>,</span>
<span>                    SumOcta <span class="op">=</span> <span class="va">OCTA</span>,</span>
<span>                    SumOrtho <span class="op">=</span> <span class="va">ORTHO</span>,</span>
<span>                    Sum6 <span class="op">=</span> <span class="va">SIX</span><span class="op">)</span></span>
<span>  <span class="va">PCBsums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">PCBsums</span>, <span class="va">add</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Pour les BFR</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BFRsums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>FID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      SumPBDE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      SumPentaBDE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      SumOctaBDE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      SumDecaBDE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">BFRcen</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co">#cycles through the individual samples</span></span>
<span>  <span class="co">#i=7 #troubleshooting</span></span>
<span>  </span>
<span>  <span class="va">ind</span> <span class="op">&lt;-</span> <span class="va">BFRcen</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  <span class="va">indconc</span> <span class="op">&lt;-</span> <span class="va">ind</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">31</span>, names_to <span class="op">=</span> <span class="st">"Compound"</span>, values_to <span class="op">=</span> <span class="st">"Concentration"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FID"</span>, <span class="st">"Year"</span>,<span class="st">"Compound"</span>, <span class="st">"Concentration"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">indcen</span> <span class="op">&lt;-</span> <span class="va">ind</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">32</span><span class="op">:</span><span class="fl">52</span>, names_to <span class="op">=</span> <span class="st">"Compound"</span>, values_to <span class="op">=</span> <span class="st">"Cen"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FID"</span>, <span class="st">"Year"</span>,<span class="st">"Compound"</span>, <span class="st">"Cen"</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="va">indcen</span><span class="op">$</span><span class="va">Compound</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">indcen</span><span class="op">$</span><span class="va">Compound</span>, <span class="st">"cen"</span>, <span class="st">""</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">indlong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">indconc</span>, <span class="va">indcen</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FID"</span>, <span class="st">"Year"</span>, <span class="st">"Compound"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">indlong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">indlong</span><span class="op">)</span></span>
<span>  <span class="co">#print(indlong$FID) #see where errors are occuring</span></span>
<span>  </span>
<span>  <span class="co">#First all 14 OCs</span></span>
<span>  <span class="va">U</span> <span class="op">&lt;-</span> <span class="va">indlong</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">V</span> <span class="op">&lt;-</span> <span class="va">indlong</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  <span class="va">indfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="fu">censtats</span><span class="op">(</span><span class="va">U</span>, <span class="va">V</span><span class="op">)</span><span class="op">)</span> <span class="co">#need to be vectors</span></span>
<span>  </span>
<span>  <span class="va">num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">indlong</span><span class="op">)</span></span>
<span>  <span class="va">sumpbde</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">indfit</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">num</span></span>
<span>  </span>
<span>  <span class="co">#</span></span>
<span>  <span class="co">#Penta-BDEs</span></span>
<span>  <span class="va">pentabde</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="va">Compound</span> <span class="op">==</span> <span class="st">"BDE47"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"BDE99"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"BDE100"</span> </span>
<span>                  <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"BDE153"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"BDE154/BB153"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"BDE85"</span><span class="op">)</span></span>
<span>  <span class="va">pentabdec</span> <span class="op">&lt;-</span> <span class="va">pentabde</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">pentabdecen</span> <span class="op">&lt;-</span> <span class="va">pentabde</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  <span class="va">pentabdefit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pentabde</span>, <span class="fu">censtats</span><span class="op">(</span><span class="va">pentabdec</span>, <span class="va">pentabdecen</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">PentaBDE</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">pentabdefit</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pentabde</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#Octa-BDEs</span></span>
<span>  <span class="va">octabde</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="va">Compound</span> <span class="op">==</span> <span class="st">"BDE183"</span> <span class="op">|</span> <span class="va">Compound</span> <span class="op">==</span> <span class="st">"BDE209"</span><span class="op">)</span></span>
<span>  <span class="va">octabdec</span> <span class="op">&lt;-</span> <span class="va">octabde</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">octabdecen</span> <span class="op">&lt;-</span> <span class="va">octabde</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  <span class="va">octabdefit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">octabde</span>, <span class="fu">censtats</span><span class="op">(</span><span class="va">octabdec</span>, <span class="va">octabdecen</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">OctaBDE</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">octabdefit</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">octabde</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#Deca is only 209 so we'll add in manually</span></span>
<span>  <span class="va">decabde</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">indlong</span>, <span class="va">Compound</span> <span class="op">==</span> <span class="st">"BDE209"</span><span class="op">)</span></span>
<span>  <span class="va">decabdec</span> <span class="op">&lt;-</span> <span class="va">decabde</span><span class="op">$</span><span class="va">Concentration</span></span>
<span>  <span class="va">decabdecen</span> <span class="op">&lt;-</span> <span class="va">decabde</span><span class="op">$</span><span class="va">Cen</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">add</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>FID <span class="op">=</span> <span class="va">ind</span><span class="op">$</span><span class="va">FID</span>,</span>
<span>                    SumPBDE <span class="op">=</span> <span class="va">sumpbde</span>,</span>
<span>                    SumPentaBDE <span class="op">=</span> <span class="va">PentaBDE</span>,</span>
<span>                    SumOctaBDE <span class="op">=</span> <span class="va">OctaBDE</span>,</span>
<span>                    SumDecaBDE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">decabdecen</span> <span class="op">==</span> <span class="st">"FALSE"</span>, <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">decabdec</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">BFRsums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">BFRsums</span>, <span class="va">add</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Plusieurs lignes du script sont importantes car elles empêchent la
loop de briser (“fail safes”): 1. si tous les composés d’une famille ont
des valeurs censurées pour un échantillon, la moyenne ne peut pas être
estimée alors la loop passera automatiquement au prochain échantillon.
Si la loop saute un échantillon, le FID sera imprimé dans le output dans
la console. Alors comme pour impute(), il est important de vérifier dans
la console les échantillons qui ont été sautés et de les traiter
manuellement. Pour ce faire, rouler la loop pour un échantillon
spécifique en roulant i = X (X = numéro de la rangée de l’échantillon),
et noter les valeurs des sommes dans un autre dataframe)</p>
<p>Exemple: les NAs représentent les sommes qui n’ont pas pu être
calculés pour 4 échantillons.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PCBpatch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>FID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"W223432-04"</span>, <span class="st">"W232539-01"</span>, </span>
<span>                               <span class="st">"W232539-02"</span>, <span class="st">"W232539-03"</span><span class="op">)</span>,</span>
<span>           SumPCB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3936</span>, <span class="fl">0.1833</span>, <span class="fl">0.0868</span>, <span class="fl">0.1481</span><span class="op">)</span>,</span>
<span>           SumTetra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0.0068</span>, <span class="fl">0.004</span>, <span class="fl">0.0083</span><span class="op">)</span>,</span>
<span>           SumPenta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0609</span>, <span class="fl">0.0433</span>, <span class="fl">0.0144</span>, <span class="fl">0.0388</span><span class="op">)</span>,</span>
<span>           SumHexa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.196</span>, <span class="fl">0.0666</span>, <span class="fl">0.0278</span>, <span class="fl">0.0522</span><span class="op">)</span>,</span>
<span>           SumHepta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0872</span>, <span class="fl">0.0424</span>, <span class="fl">0.0251</span>, <span class="fl">0.0318</span><span class="op">)</span>,</span>
<span>           SumOcta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0087</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>           SumOrtho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0449</span>, <span class="fl">0.0247</span>, <span class="fl">0.0082</span>, <span class="fl">0.0207</span><span class="op">)</span>,</span>
<span>           Sum6 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2136</span>, <span class="fl">0.0805</span>, <span class="fl">0.0365</span>, <span class="fl">0.0655</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">PCBsums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">PCBsums</span>, <span class="va">PCBpatch</span><span class="op">)</span></span></code></pre></div>
<p>Dépendant des jeux de données, il faudra ajouter les lignes de script
comme “fail safes” (voir plus haut) à d’autres familles de contaminants.
Vous pouvez toujours le rajouter à toutes les sommes si c’est plus
facile que d’identifier la famille qui pose problème, mais bien faire
attention de changer le df auquel il se réfère:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="va">tetra</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">indlong</span><span class="op">$</span><span class="va">FID</span><span class="op">)</span><span class="op">}</span> </span>
<span><span class="co">#tetra is the df that needs to be changed for each sum</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="va">tetra</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">4</span><span class="op">)</span> <span class="kw">next</span> </span>
<span><span class="co">#tetra is the df that needs to be changed for each sum</span></span></code></pre></div>
<p>Une fois que tout roule bien, on joint le output de impute() (ex.
OCint) à l’output des sommes (ex. OCsums).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">OCint</span>, <span class="va">OCsums</span>, by <span class="op">=</span> <span class="st">"FID"</span><span class="op">)</span></span></code></pre></div>
<p>Voilà! Les valeurs censurées sont gérées et prêtes pour les tests
statistiques :)</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Steve Vissault, Anais Kerric, Rose Lacombe, Raphael Lavoie.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
